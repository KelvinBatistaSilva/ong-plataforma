function maskCPF(v){return v.replace(/\D/g,'').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2').slice(0,14);}function maskPhone(v){v=v.replace(/\D/g,'');if(v.length<=10){return v.replace(/(\d{2})(\d)/,'($1) $2').replace(/(\d{4})(\d)/,'$1-$2').slice(0,14);}return v.replace(/(\d{2})(\d)/,'($1) $2').replace(/(\d{5})(\d)/,'$1-$2').slice(0,15);}function maskCEP(v){return v.replace(/\D/g,'').replace(/(\d{5})(\d)/,'$1-$2').slice(0,9);}function cpfValido(cpf){cpf=(cpf||'').replace(/\D/g,'');if(!cpf||cpf.length!==11||/^([0-9])\1+$/.test(cpf))return false;let sum=0,rest;for(let i=1;i<=9;i++)sum+=parseInt(cpf.substring(i-1,i))*(11-i);rest=(sum*10)%11;if(rest===10||rest===11)rest=0;if(rest!==parseInt(cpf.substring(9,10)))return false;sum=0;for(let i=1;i<=10;i++)sum+=parseInt(cpf.substring(i-1,i))*(12-i);rest=(sum*10)%11;if(rest===10||rest===11)rest=0;return rest===parseInt(cpf.substring(10,11));}export const Forms={enhanceCadastro(){const form=document.querySelector('#cad-form');if(!form)return;const nome=form.querySelector('#nome');const email=form.querySelector('#email');const cpf=form.querySelector('#cpf');const tel=form.querySelector('#telefone');const nasc=form.querySelector('#nascimento');const cep=form.querySelector('#cep');const estado=form.querySelector('#estado');const toast=document.querySelector('#toast');cpf.addEventListener('input',()=>cpf.value=maskCPF(cpf.value));tel.addEventListener('input',()=>tel.value=maskPhone(tel.value));cep.addEventListener('input',()=>cep.value=maskCEP(cep.value));function idadeMinimaOk(){const v=nasc.value;if(!v)return false;const d=new Date(v);const h=new Date();let idade=h.getFullYear()-d.getFullYear();const m=h.getMonth()-d.getMonth();if(m<0||(m===0&&h.getDate()<d.getDate()))idade--;return idade>=16;}function dddComp(){const match=tel.value.match(/^\((\d{2})\)/);const ddd=match?match[1]:null;if(!ddd||!estado.value)return true;const mapa={"RO":["69"],"SP":["11","12","13","14","15","16","17","18","19"],"RJ":["21","22","24"],"MG":["31","32","33","34","35","37","38"],"PR":["41","42","43","44","45","46"],"MS":["67"],"MT":["65","66"],"AM":["92","97"],"AC":["68"],"PA":["91","93","94"]};return (mapa[estado.value]||[]).includes(ddd);}function showError(input,msg){const slot=form.querySelector(`.error[data-for="${input.id}"]`);if(slot)slot.textContent=msg||'';}form.addEventListener('submit',e=>{e.preventDefault();let ok=true;if(!nome.checkValidity()){ok=false;showError(nome,nome.title||'Nome inválido');}else showError(nome,'');if(!email.checkValidity()){ok=false;showError(email,email.title||'E-mail inválido');}else showError(email,'');if(!cpf.checkValidity()||!cpfValido(cpf.value)){ok=false;showError(cpf,'CPF inválido');}else showError(cpf,'');if(!tel.checkValidity()){ok=false;showError(tel,tel.title||'Telefone inválido');}else showError(tel,'');if(!nasc.checkValidity()||!idadeMinimaOk()){ok=false;showError(nasc,'Idade mínima: 16 anos');}else showError(nasc,'');if(!cep.checkValidity()){ok=false;showError(cep,'CEP inválido');}else showError(cep,'');if(!estado.checkValidity()){ok=false;showError(estado,'Selecione o estado');}else showError(estado,'');if(!dddComp()){ok=false;showError(tel,'DDD incompatível com UF');}if(!ok)return;const payload={nome:nome.value,email:email.value,cpf:cpf.value,tel:tel.value,nasc:nasc.value,cep:cep.value,estado:estado.value,ts:Date.now()};const arr=JSON.parse(localStorage.getItem('cadastros')||'[]');arr.push(payload);localStorage.setItem('cadastros',JSON.stringify(arr));if(toast){toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),2500);}form.reset();});}}